import React, { useRef, useState } from "react";
import jsPDF from "jspdf";
import html2canvas from "html2canvas";
import { useNavigate } from "react-router-dom";
import { FaLeaf } from "react-icons/fa";

const translations = {
  en: {
    uploadLabel: "Upload a plant leaf image",
    detectButton: "ЁЯФН Detect Disease",
    detectingButton: "ЁЯФД Detecting...",
    prediction: "Prediction",
    confidence: "Confidence",
    generatePrescription: "ЁЯТК Generate Prescription",
    suggestedTreatment: "ЁЯзк Suggested Treatment",
    suggestedPesticide: "Suggested Pesticide",
    treatment: "Treatment",
    plantCareAdvice: "Plant care advice",
    errorFetching: "Error fetching prescription",
  },
  bn: {
    uploadLabel: "ржЧрж╛ржЫрзЗрж░ ржкрж╛рждрж╛рж░ ржЫржмрж┐ ржЖржкрж▓рзЛржб ржХрж░рзБржи",
    detectButton: "ЁЯФН рж░рзЛржЧ рж╕ржирж╛ржХрзНржд ржХрж░рзБржи",
    detectingButton: "ЁЯФД рж╕ржирж╛ржХрзНрждржХрж░ржг ржЪрж▓ржЫрзЗ...",
    prediction: "ржбрж╛ржЯрж╛ ржнрж┐рждрзНрждрж┐ржХ ржЕржирзБржорж╛ржи",
    confidence: "рж╕ржорзНржнрж╛ржмрзНржпрждрж╛",
    generatePrescription: "ЁЯТК ржкрзНрж░рзЗрж╕ржХрзНрж░рж┐ржкрж╢ржи рждрзИрж░рж┐ ржХрж░рзБржи",
    suggestedTreatment: "ЁЯзк ржкрзНрж░рж╕рзНрждрж╛ржмрж┐ржд ржЪрж┐ржХрж┐рзОрж╕рж╛",
    suggestedPesticide: "ржкрзНрж░рж╕рзНрждрж╛ржмрж┐ржд ржХрзАржЯржирж╛рж╢ржХ",
    treatment: "ржЪрж┐ржХрж┐рзОрж╕рж╛",
    plantCareAdvice: "ржЧрж╛ржЫрзЗрж░ ржпрждрзНржирзЗрж░ ржкрж░рж╛ржорж░рзНрж╢",
    errorFetching: "ржкрзНрж░рзЗрж╕ржХрзНрж░рж┐ржкрж╢ржи ржЖржирждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗ",

    diseaseDict: {
      Apple___Apple_scab: "ржЖржкрзЗрж▓ тАУ ржкрж╛рждрж╛рзЯ ржжрж╛ржЧ рж░рзЛржЧ",
      Apple___Black_rot: "ржЖржкрзЗрж▓ тАУ ржХрж╛рж▓рзЛ ржкржБржЪрж╛ рж░рзЛржЧ",
      Apple___Cedar_apple_rust: "ржЖржкрзЗрж▓ тАУ ржЬржВ рж░рзЛржЧ (рж╕рж┐ржбрж╛рж░ рж░рж╕рзНржЯ)",
      Apple___healthy: "ржЖржкрзЗрж▓ тАУ рж╕рзБрж╕рзНрже",
      Blueberry___healthy: "ржмрзНрж▓рзБржмрзЗрж░рж┐ тАУ рж╕рзБрж╕рзНрже",
      "Cherry_(including_sour)___Powdery_mildew":
        "ржЪрзЗрж░рж┐ тАУ ржкрж╛рждрж╛рзЯ рж╕рж╛ржжрж╛ ржЧрзБржБрзЬрж╛рж░ ржЫрждрзНрж░рж╛ржХ",
      "Cherry_(including_sour)___healthy": "ржЪрзЗрж░рж┐ тАУ рж╕рзБрж╕рзНрже",
      "Corn_(maize)___Cercospora_leaf_spot Gray_leaf_spot":
        "ржнрзБржЯрзНржЯрж╛ тАУ ржкрж╛рждрж╛рж░ рж╕рж╛ржжрж╛/ржзрзВрж╕рж░ ржжрж╛ржЧ",
      "Corn_(maize)___Common_rust_": "ржнрзБржЯрзНржЯрж╛ тАУ рж╕рж╛ржзрж╛рж░ржг ржЬржВ рж░рзЛржЧ",
      "Corn_(maize)___Northern_Leaf_Blight": "ржнрзБржЯрзНржЯрж╛ тАУ ржкрж╛рждрж╛рж░ ржкрзЛрзЬрж╛ ржжрж╛ржЧ рж░рзЛржЧ",
      "Corn_(maize)___healthy": "ржнрзБржЯрзНржЯрж╛ тАУ рж╕рзБрж╕рзНрже",
      Grape___Black_rot: "ржЖржЩрзНржЧрзБрж░ тАУ ржХрж╛рж▓рзЛ ржкржБржЪрж╛ рж░рзЛржЧ",
      "Grape___Esca_(Black_Measles)": "ржЖржЩрзНржЧрзБрж░ тАУ ржХрж╛рж▓рзЛ ржжрж╛ржЧ рж░рзЛржЧ (ржПрж╕рзНржХрж╛)",
      "Grape___Leaf_blight_(Isariopsis_Leaf_Spot)": "ржЖржЩрзНржЧрзБрж░ тАУ ржкрж╛рждрж╛рж░ ржжрж╛ржЧ рж░рзЛржЧ",
      Grape___healthy: "ржЖржЩрзНржЧрзБрж░ тАУ рж╕рзБрж╕рзНрже",
      "Orange___Haunglongbing_(Citrus_greening)":
        "ржХржорж▓рж╛ тАУ ржкрж╛рждрж╛рзЯ рж╣рж▓ржжрзЗ ржжрж╛ржЧ рж░рзЛржЧ (рж╕рж╛ржЗржЯрзНрж░рж╛рж╕ ржЧрзНрж░рж┐ржирж┐ржВ)",
      Peach___Bacterial_spot: "ржкрзАржЪ тАУ ржмрзНржпрж╛ржХржЯрзЗрж░рж┐рзЯрж╛ ржжрж╛ржЧ",
      Peach___healthy: "ржкрзАржЪ тАУ рж╕рзБрж╕рзНрже",
      "Pepper,_bell___Bacterial_spot": "ржмрзЗрж▓ ржорж░рж┐ржЪ тАУ ржмрзНржпрж╛ржХржЯрзЗрж░рж┐рзЯрж╛ ржжрж╛ржЧ",
      "Pepper,_bell___healthy": "ржмрзЗрж▓ ржорж░рж┐ржЪ тАУ рж╕рзБрж╕рзНрже",
      Potato___Early_blight: "ржЖрж▓рзБ тАУ ржЖржЧрж╛ржо ржкржЪрж╛ рж░рзЛржЧ",
      Potato___Late_blight: "ржЖрж▓рзБ тАУ ржжрзЗрж░рж┐рждрзЗ ржкржЪрж╛ рж░рзЛржЧ (ржкржЯржХрж╛)",
      Potato___healthy: "ржЖрж▓рзБ тАУ рж╕рзБрж╕рзНрже",
      Raspberry___healthy: "рж░рж╛рж╕рзНржкржмрзЗрж░рж┐ тАУ рж╕рзБрж╕рзНрже",
      Soybean___healthy: "рж╕рзЯрж╛ржмрж┐ржи тАУ рж╕рзБрж╕рзНрже",
      Squash___Powdery_mildew: "рж╕рзНржХрзЛрзЯрж╛рж╢ тАУ ржкрж╛рждрж╛рзЯ рж╕рж╛ржжрж╛ ржЧрзБржБрзЬрж╛ ржЫрждрзНрж░рж╛ржХ",
      Strawberry___Leaf_scorch: "рж╕рзНржЯрзНрж░ржмрзЗрж░рж┐ тАУ ржкрж╛рждрж╛рзЯ ржкрзЛрзЬрж╛ ржжрж╛ржЧ",
      Strawberry___healthy: "рж╕рзНржЯрзНрж░ржмрзЗрж░рж┐ тАУ рж╕рзБрж╕рзНрже",
      Tomato___Bacterial_spot: "ржЯржорзЗржЯрзЛ тАУ ржмрзНржпрж╛ржХржЯрзЗрж░рж┐рзЯрж╛ ржжрж╛ржЧ",
      Tomato___Early_blight: "ржЯржорзЗржЯрзЛ тАУ ржЖржЧрж╛ржо ржкрзЛрзЬрж╛ рж░рзЛржЧ",
      Tomato___Late_blight: "ржЯржорзЗржЯрзЛ тАУ ржжрзЗрж░рж┐рждрзЗ ржкрзЛрзЬрж╛ рж░рзЛржЧ",
      Tomato___Leaf_Mold: "ржЯржорзЗржЯрзЛ тАУ ржкрж╛рждрж╛рж░ ржЫрждрзНрж░рж╛ржХ рж░рзЛржЧ",
      Tomato___Septoria_leaf_spot: "ржЯржорзЗржЯрзЛ тАУ рж╕рзЗржкрзНржЯрзЛрж░рж┐рзЯрж╛ ржжрж╛ржЧ",
      "Tomato___Spider_mites Two-spotted_spider_mite":
        "ржЯржорзЗржЯрзЛ тАУ рж▓рж╛рж▓ ржорж╛ржХрзЬ ржкрзЛржХрж╛ рж╕ржВржХрзНрж░ржоржг",
      Tomato___Target_Spot: "ржЯржорзЗржЯрзЛ тАУ рж▓ржХрзНрж╖рзНржоржг ржЪрж┐рж╣рзНржиржпрзБржХрзНржд ржжрж╛ржЧ",
      Tomato___Tomato_Yellow_Leaf_Curl_Virus: "ржЯржорзЗржЯрзЛ тАУ рж╣рж▓рзБржж ржкрж╛рждрж╛рж░ ржнрж╛ржБржЬ ржнрж╛ржЗрж░рж╛рж╕",
      Tomato___Tomato_mosaic_virus: "ржЯржорзЗржЯрзЛ тАУ ржорзЛржЬрж╛ржЗржХ ржнрж╛ржЗрж░рж╛рж╕",
      Tomato___healthy: "ржЯржорзЗржЯрзЛ тАУ рж╕рзБрж╕рзНрже",
    },
  },
};

function Plantdiseaseditect() {
  const [image, setImage] = useState(null);
  const [preview, setPreview] = useState(null);
  const [result, setResult] = useState(null);
  const [loading, setLoading] = useState(false);
  const [pdfUrl, setPdfUrl] = useState(null);
  const [showPrescription, setShowPrescription] = useState(false);
  const [prescriptionData, setPrescriptionData] = useState(null);
  const [language, setLanguage] = useState("en"); // en or bn
  const [showModal, setShowModal] = useState(false);
  const printRef = useRef();
  const navigate = useNavigate();
  const [pdfBase64ForMarket, setPdfBase64ForMarket] = useState(null);

  const handleImageChange = (e) => {
    const file = e.target.files[0];
    if (file && file.type.startsWith("image/")) {
      setImage(file);
      setPreview(URL.createObjectURL(file));
      setResult(null);
      setPrescriptionData(null);
      setShowPrescription(false);
    } else {
      setImage(null);
      setPreview(null);
      setResult(null);
      setPrescriptionData(null);
      setShowPrescription(false);
    }
  };

  const handleDetect = async () => {
    setLoading(true);
    const formData = new FormData();
    formData.append("image", image);

    try {
      const res = await fetch("http://localhost:5050/predict", {
        method: "POST",
        body: formData,
      });
      const data = await res.json();
      if (res.ok) {
        setResult(data);
        setPrescriptionData({
          suggestedPesticide: data.suggestedPesticide,
          treatment: data.treatment,
          plantCareAdvice: data.plantCareAdvice,
        });
      } else {
        setResult({ error: data.error });
      }
    } catch (err) {
      setResult({ error: err.message });
    } finally {
      setLoading(false);
    }
  };

  // Simple manual translation for prescription fields (only if backend sends only English)
  const translatePrescription = (data) => {
    if (!data) return null;
    if (language === "bn") {
      // You can expand this dictionary or call an API for dynamic translation
      const dict = {
        // Pesticides
        "Mancozeb or Captan 50 WP": "ржорзНржпрж╛ржиржХрзЛржЬрзЗржм ржмрж╛ ржХрзНржпрж╛ржкржЯрж╛ржи рзлрзж ржбржмрзНрж▓рж┐ржЙржкрж┐",
        "Thiophanate-methyl or Captan": "ржерж╛ржЗржУржлрж╛ржирзЗржЯ-ржорж┐ржерж╛ржЗрж▓ ржмрж╛ ржХрзНржпрж╛ржкржЯрж╛ржи",
        "Myclobutanil or Propiconazole": "ржорж╛ржЗржХрж▓рзЛржмрзБржЯрж╛ржирж┐рж▓ ржмрж╛ ржкрзНрж░рзЛржкрж┐ржХрзЛржирж╛ржЬрзЛрж▓",
        None: "ржХрзЛржиржУ ржкрзНрж░рзЯрзЛржЬржи ржирзЗржЗ",
        "Sulfur 80 WP or Potassium bicarbonate":
          "рж╕рж╛рж▓ржлрж╛рж░ рзорзж ржбржмрзНрж▓рж┐ржЙржкрж┐ ржмрж╛ ржкржЯрж╛рж╢рж┐рзЯрж╛ржо ржмрж╛ржЗржХрж╛рж░рзНржмрзЛржирзЗржЯ",
        "Strobilurin fungicides (Azoxystrobin) or Triazoles":
          "рж╕рзНржЯрзНрж░рзЛржмрж┐рж▓рзБрж░рж┐ржи ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб (ржЖржЬржХрзНрж╕рж┐рж╕рзНржЯрзНрж░рзЛржмрж┐ржи) ржмрж╛ ржЯрзНрж░рж┐рзЯрж╛ржЬрзЛрж▓",
        Azoxystrobin: "ржЖржЬржХрзНрж╕рж┐рж╕рзНржЯрзНрж░рзЛржмрж┐ржи",
        "Propiconazole or Tebuconazole": "ржкрзНрж░рзЛржкрж┐ржХрзЛржирж╛ржЬрзЛрж▓ ржмрж╛ ржЯрзЗржмрзБржХрзЛржирж╛ржЬрзЛрж▓",
        Chlorothalonil: "ржХрзНрж▓рзЛрж░рзЛржерзНржпрж╛рж▓рзЛржирж┐рж▓",
        "Imidacloprid (targets psyllid vector)":
          "ржЗржорж┐ржбрж╛ржХрзНрж▓рзЛржкрзНрж░рж┐ржб (рж╕рж╛ржЗрж▓рж┐ржб ржнрзЗржХрзНржЯрж░ рж▓ржХрзНрж╖рзНржп ржХрж░рзЗ)",
        "Copper hydroxide or Copper oxychloride":
          "ржХржкрж╛рж░ рж╣рж╛ржЗржбрзНрж░ржХрзНрж╕рж╛ржЗржб ржмрж╛ ржХржкрж╛рж░ ржЕржХрзНрж╕рж┐ржХрзНрж▓рзЛрж░рж╛ржЗржб",
        "Copper hydroxide plus Mancozeb": "ржХржкрж╛рж░ рж╣рж╛ржЗржбрзНрж░ржХрзНрж╕рж╛ржЗржб ржПржмржВ ржорзНржпрж╛ржиржХрзЛржЬрзЗржм",
        "Metalaxyl or Mancozeb": "ржорзЗржЯрж╛рж▓рж╛ржХрзНрж╕рж┐рж▓ ржмрж╛ ржорзНржпрж╛ржиржХрзЛржЬрзЗржм",
        "Sulfur or Neem oil": "рж╕рж╛рж▓ржлрж╛рж░ ржмрж╛ ржирж┐ржо рждрзЗрж▓",
        "Captan or Thiophanate-methyl": "ржХрзНржпрж╛ржкржЯрж╛ржи ржмрж╛ ржерж╛ржЗржУржлрж╛ржирзЗржЯ-ржорж┐ржерж╛ржЗрж▓",
        "Copper hydroxide": "ржХржкрж╛рж░ рж╣рж╛ржЗржбрзНрж░ржХрзНрж╕рж╛ржЗржб",
        "Metalaxyl or Fluopicolide": "ржорзЗржЯрж╛рж▓рж╛ржХрзНрж╕рж┐рж▓ ржмрж╛ ржлрзНрж▓рзБржкрж┐ржХрзЛрж▓рж╛ржЗржб",
        "Sulfur or Copper-based fungicides":
          "рж╕рж╛рж▓ржлрж╛рж░ ржмрж╛ ржХржкрж╛рж░ ржнрж┐рждрзНрждрж┐ржХ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб",
        "Abamectin or Neem oil": "ржЖржмрж╛ржорзЗржХржЯрж┐ржи ржмрж╛ ржирж┐ржо рждрзЗрж▓",
        Imidacloprid: "ржЗржорж┐ржбрж╛ржХрзНрж▓рзЛржкрзНрж░рж┐ржб",
        "Chlorothalonil or Mancozeb": "ржХрзНрж▓рзЛрж░рзЛржерзНржпрж╛рж▓рзЛржирж┐рж▓ ржмрж╛ ржорзНржпрж╛ржиржХрзЛржЬрзЗржм",
        "Myclobutanil or Mancozeb": "ржорж╛ржЗржХрж▓рзЛржмрзБржЯрж╛ржирж┐рж▓ ржмрж╛ ржорзНржпрж╛ржиржХрзЛржЬрзЗржм",

        // Treatments
        "Use resistant apple varieties; apply fungicide at bud break and repeat every 10тАУ14 days during the growing season.":
          "ржкрзНрж░рждрж┐рж░рзЛржзрзА ржЖржкрзЗрж▓ ржЬрж╛ржд ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи; ржлрзБрж▓ ржлрзЛржЯрж╛рж░ рж╕ржорзЯ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржи ржПржмржВ ржкрзНрж░рждрж┐ рззрзж-рззрзк ржжрж┐ржирзЗ ржкрзБржирж░рж╛ржмрзГрждрзНрждрж┐ ржХрж░рзБржиред",
        "Remove mummified fruits and infected twigs; apply fungicide pre-bloom and during growing season.":
          "ржорзГржд ржлрж▓ ржПржмржВ рж╕ржВржХрзНрж░ржорж┐ржд рж╢рж╛ржЦрж╛ рж╕рж░рж┐рзЯрзЗ ржлрзЗрж▓рзБржи; ржлрзБрж▓ ржлрзЛржЯрж╛рж░ ржЖржЧрзЗ ржПржмржВ ржмрж╛рзЬржирзНржд ржорж░рж╢рзБржорзЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Apply fungicide early in the spring; remove nearby cedar/juniper trees to reduce infection source.":
          "ржмрж╕ржирзНрждрзЗрж░ рж╢рзБрж░рзБрждрзЗржЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржи; рж╕ржВржХрзНрж░ржоржгрзЗрж░ ржЙрзОрж╕ ржХржорж╛рждрзЗ ржХрж╛ржЫрж╛ржХрж╛ржЫрж┐ рж╕рж┐ржбрж╛рж░/ржЬрзБржирж┐ржкрж╛рж░ ржЧрж╛ржЫ рж╕рж░рж┐рзЯрзЗ ржлрзЗрж▓рзБржиред",
        "No treatment required. Maintain orchard hygiene.":
          "ржХрзЛржиржУ ржЪрж┐ржХрж┐рзОрж╕рж╛рж░ ржкрзНрж░рзЯрзЛржЬржи ржирзЗржЗред ржмрж╛ржЧрж╛ржирзЗрж░ ржкрж░рж┐ржЪрзНржЫржирзНржирждрж╛ ржмржЬрж╛рзЯ рж░рж╛ржЦрзБржиред",
        "Maintain proper pruning and weed control.":
          "рж╕ржарж┐ржХржнрж╛ржмрзЗ ржЫрж╛ржБржЯрж╛ржЗ ржПржмржВ ржЖржЧрж╛ржЫрж╛ ржирж┐рзЯржирзНрждрзНрж░ржг ржмржЬрж╛рзЯ рж░рж╛ржЦрзБржиред",
        "Apply sulfur-based fungicides and prune to improve airflow.":
          "рж╕рж╛рж▓ржлрж╛рж░ржнрж┐рждрзНрждрж┐ржХ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржи ржПржмржВ ржмрж╛рждрж╛рж╕ ржЪрж▓рж╛ржЪрж▓рзЗрж░ ржЬржирзНржп ржЫрж╛ржБржЯрж╛ржЗ ржХрж░рзБржиред",
        "No treatment necessary; maintain good orchard practices.":
          "ржЪрж┐ржХрж┐рзОрж╕рж╛рж░ ржкрзНрж░рзЯрзЛржЬржи ржирзЗржЗ; ржнрж╛рж▓ ржмрж╛ржЧрж╛ржи ржкрж░рж┐ржЪрж░рзНржпрж╛ ржмржЬрж╛рзЯ рж░рж╛ржЦрзБржиред",
        "Practice crop rotation; apply fungicide at tasseling stage.":
          "ржлрж╕рж▓ ржкрж╛рж▓рзНржЯрзЗ рж▓рж╛ржЧрж╛ржи; ржкрзБржВржлрзБрж▓ ржкрж░рзНржпрж╛рзЯрзЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Use resistant hybrids; apply fungicide if disease severity is high.":
          "ржкрзНрж░рждрж┐рж░рзЛржзрзА рж╣рж╛ржЗржмрзНрж░рж┐ржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи; рж░рзЛржЧрзЗрж░ ржорж╛рждрзНрж░рж╛ ржмрзЗрж╢рж┐ рж╣рж▓рзЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Plant resistant varieties and use foliar fungicides under disease pressure.":
          "ржкрзНрж░рждрж┐рж░рзЛржзрзА ржЬрж╛ржд рж░рзЛржкржг ржХрж░рзБржи ржПржмржВ рж░рзЛржЧрзЗрж░ ржЪрж╛ржк ржерж╛ржХрж▓рзЗ ржкрж╛рждрж╛ рж▓рж╛ржЧрж╛ржирзЛ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред",
        "Remove infected leaves; apply fungicide pre-bloom and during growing season.":
          "рж╕ржВржХрзНрж░ржорж┐ржд ржкрж╛рждрж╛ рж╕рж░рж┐рзЯрзЗ ржлрзЗрж▓рзБржи; ржлрзБрж▓ ржлрзЛржЯрж╛рж░ ржЖржЧрзЗ ржПржмржВ ржмрж╛рзЬржирзНржд ржорж░рж╢рзБржорзЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "No chemical control; remove and destroy infected vines.":
          "ржХрзЛржиржУ рж░рж╛рж╕рж╛рзЯржирж┐ржХ ржирж┐рзЯржирзНрждрзНрж░ржг ржирзЗржЗ; рж╕ржВржХрзНрж░ржорж┐ржд рж▓рждрж╛ рж╕рж░рж┐рзЯрзЗ ржирж╖рзНржЯ ржХрж░рзБржиред",
        "Apply contact fungicides and improve canopy ventilation.":
          "ржХржирзНржЯрж╛ржХрзНржЯ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржи ржПржмржВ ржЧрж╛ржЫрзЗрж░ ржЫрждрзНрж░рж╛ ржмрж╛рждрж╛рж╕ ржЪрж▓рж╛ржЪрж▓рзЗрж░ ржЬржирзНржп ржЙржирзНржиржд ржХрж░рзБржиред",
        "No cure available; promptly remove infected trees to prevent spread.":
          "ржХрзЛржиржУ ржирж┐рж░рж╛ржорзЯ ржирзЗржЗ; ржжрзНрж░рзБржд рж╕ржВржХрзНрж░ржорж┐ржд ржЧрж╛ржЫ рж╕рж░рж┐рзЯрзЗ ржЫрзЬрж╛ржирзЛ рж░рзЛржз ржХрж░рзБржиред",
        "Use copper-based sprays; plant resistant varieties.":
          "ржХржкрж╛рж░-ржнрж┐рждрзНрждрж┐ржХ рж╕рзНржкрзНрж░рзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи; ржкрзНрж░рждрж┐рж░рзЛржзрзА ржЬрж╛ржд рж░рзЛржкржг ржХрж░рзБржиред",
        "Use disease-free seeds; apply copper-based sprays to manage bacterial spot.":
          "рж░рзЛржЧржорзБржХрзНржд ржмрзАржЬ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи; ржмрзНржпрж╛ржХржЯрзЗрж░рж┐рзЯрж╛рж▓ рж╕рзНржкржЯ ржирж┐рзЯржирзНрждрзНрж░ржгрзЗ ржХржкрж╛рж░-ржнрж┐рждрзНрждрж┐ржХ рж╕рзНржкрзНрж░рзЗ ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Apply fungicides starting at flowering to prevent early blight.":
          "ржкрзНрж░рж╕рзНржлрзБржЯржирзЗрж░ рж╕ржорзЯ ржерзЗржХрзЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ рж╢рзБрж░рзБ ржХрж░рзБржи, ржЖржЧрж╛ржо ржмрзНрж▓рж╛ржЗржЯ ржкрзНрж░рждрж┐рж░рзЛржзрзЗред",
        "Use certified seed and systemic fungicides to prevent late blight.":
          "рж╕рж╛рж░рзНржЯрж┐ржлрж╛рзЯрзЗржб ржмрзАржЬ ржПржмржВ рж╕рж┐рж╕рзНржЯрзЗржорж┐ржХ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи, ржжрзЗрж░рзА ржмрзНрж▓рж╛ржЗржЯ ржкрзНрж░рждрж┐рж░рзЛржзрзЗред",
        "Prune in early spring and monitor for pests.":
          "ржмрж╕ржирзНрждрзЗрж░ рж╢рзБрж░рзБрждрзЗ ржЫрж╛ржБржЯрж╛ржЗ ржХрж░рзБржи ржПржмржВ ржкрзЛржХрж╛ржорж╛ржХрзЬ ржиржЬрж░ рж░рж╛ржЦрзБржиред",
        "Scout fields regularly for leaf spot and rust diseases.":
          "ржкрж╛рждрж╛рж░ ржжрж╛ржЧ ржПржмржВ ржЬржВ рж░рзЛржЧрзЗрж░ ржЬржирзНржп ржирж┐рзЯржорж┐ржд ржорж╛ржарзЗ ржиржЬрж░ рж░рж╛ржЦрзБржиред",
        "Apply fungicides at first signs of powdery mildew.":
          "ржкрж╛рждрж╛рзЯ рж╕рж╛ржжрж╛ ржЧрзБржБрзЬрзЛ ржЫрждрзНрж░рж╛ржХ рж░рзЛржЧ рж▓ржХрзНрж╖ржг ржжрзЗржЦрж╛ ржжрж┐рж▓рзЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Remove infected leaves and apply fungicides promptly.":
          "рж╕ржВржХрзНрж░ржорж┐ржд ржкрж╛рждрж╛ рж╕рж░рж┐рзЯрзЗ ржжрзНрж░рзБржд ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Apply copper sprays and rotate crops to manage bacterial spot.":
          "ржмрзНржпрж╛ржХржЯрзЗрж░рж┐рзЯрж╛рж▓ рж╕рзНржкржЯ ржирж┐рзЯржирзНрждрзНрж░ржгрзЗ ржХржкрж╛рж░ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржи ржПржмржВ ржлрж╕рж▓ ржкрж╛рж▓рзНржЯрзЗ рж▓рж╛ржЧрж╛ржиред",
        "Apply fungicide every 7тАУ10 days; remove lower leaves to improve airflow.":
          "ржкрзНрж░рждрж┐ рзн-рззрзж ржжрж┐ржирзЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржи; ржмрж╛рждрж╛рж╕ ржЪрж▓рж╛ржЪрж▓рзЗрж░ ржЬржирзНржп ржирж┐ржЪрзЗрж░ ржкрж╛рждрж╛ рж╕рж░рж┐рзЯрзЗ ржлрзЗрж▓рзБржиред",
        "Use resistant varieties and apply systemic fungicides proactively.":
          "ржкрзНрж░рждрж┐рж░рзЛржзрзА ржЬрж╛ржд ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи ржПржмржВ рж╕рж┐рж╕рзНржЯрзЗржорж┐ржХ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржЖржЧрзЗржнрж╛ржЧрзЗржЗ ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Improve ventilation and apply sulfur or copper-based sprays.":
          "ржмрж╛рждрж╛рж╕ ржЪрж▓рж╛ржЪрж▓ ржЙржирзНржиржд ржХрж░рзБржи ржПржмржВ ржЧржирзНржзржХ ржмрж╛ ржХржкрж╛рж░ рж╕рзНржкрзНрж░рзЗ ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Spray neem oil or insecticidal soap to control spider mites.":
          "рж╕рзНржкрж╛ржЗржбрж╛рж░ ржорж╛ржЗржЯ ржирж┐рзЯржирзНрждрзНрж░ржгрзЗ ржирж┐ржо рждрзЗрж▓ ржмрж╛ ржХрзАржЯржирж╛рж╢ржХ рж╕рж╛ржмрж╛ржи рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Apply fungicides during early fruit set to prevent target spot.":
          "ржЯрж╛рж░рзНржЧрзЗржЯ рж╕рзНржкржЯ ржкрзНрж░рждрж┐рж░рзЛржзрзЗ рж╢рзБрж░рзБрждрзЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Use resistant varieties and control whitefly vectors.":
          "ржкрзНрж░рждрж┐рж░рзЛржзрзА ржЬрж╛ржд ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи ржПржмржВ рж╣рзЛрзЯрж╛ржЗржЯржлрзНрж▓рж╛ржЗ ржирж┐рзЯржирзНрждрзНрж░ржг ржХрж░рзБржиред",
        "Remove infected plants and sanitize tools to prevent spread.":
          "рж╕ржВржХрзНрж░ржорж┐ржд ржЧрж╛ржЫ рж╕рж░рж┐рзЯрзЗ ржлрзЗрж▓рзБржи ржПржмржВ ржЫрзЬрж╛ржирзЛ рж░рзЛржзрзЗ рж╕рж░ржЮрзНржЬрж╛ржо рж╕рзНржпрж╛ржирж┐ржЯрж╛ржЗржЬ ржХрж░рзБржиред",
        "Regular pruning and fertilization to maintain tree health.":
          "ржЧрж╛ржЫрзЗрж░ рж╕рзБрж╕рзНржерждрж╛ ржмржЬрж╛рзЯ рж░рж╛ржЦрждрзЗ ржирж┐рзЯржорж┐ржд ржЫрж╛ржБржЯрж╛ржЗ ржПржмржВ рж╕рж╛рж░ ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Maintain good drainage and adequate sunlight.":
          "ржнрж╛рж▓ ржЬрж▓ ржирж┐рж╖рзНржХрж╛рж╢ржи ржПржмржВ ржкрж░рзНржпрж╛ржкрзНржд рж╕рзВрж░рзНржпрж╛рж▓рзЛржХ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржиред",
        "Maintain balanced fertilization and monitor plants weekly.":
          "рж╕рзБрж╖ржо рж╕рж╛рж░ ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржи ржПржмржВ рж╕рж╛ржкрзНрждрж╛рж╣рж┐ржХ ржЧрж╛ржЫ ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржХрж░рзБржиред",

        // Plant care advice
        "Spray 20 grams in 10 liters of water before bud break and repeat application every 10тАУ14 days.":
          "ржлрзБрж▓ ржлрзЛржЯрж╛рж░ ржЖржЧрзЗ рззрзж рж▓рж┐ржЯрж╛рж░ ржкрж╛ржирж┐рждрзЗ рзирзж ржЧрзНрж░рж╛ржо рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржи ржПржмржВ ржкрзНрж░рждрж┐ рззрзж-рззрзк ржжрж┐ржирзЗ ржкрзБржирж░рж╛рзЯ ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Spray 25 grams per 10 liters of water every 7тАУ14 days during pre-bloom and early season.":
          "ржкрзНрж░рж╛ржХ-ржлрзБрж▓ ржПржмржВ рж╢рзБрж░рзБрж░ ржорж░рж╢рзБржорзЗ ржкрзНрж░рждрж┐ рззрзж рж▓рж┐ржЯрж╛рж░ ржкрж╛ржирж┐рждрзЗ рзирзл ржЧрзНрж░рж╛ржо рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржи, ржкрзНрж░рждрж┐ рзн-рззрзк ржжрж┐ржирзЗред",
        "Spray every 10тАУ14 days starting at bud swell until early summer.":
          "ржмрж╛ржб ржлрзБрж▓рзЗ ржЙржарж╛ ржерзЗржХрзЗ рж╢рзБрж░рзБ ржХрж░рзЗ ржЧрзНрж░рзАрж╖рзНржорзЗрж░ рж╢рзБрж░рзБ ржкрж░рзНржпржирзНржд ржкрзНрж░рждрж┐ рззрзж-рззрзк ржжрж┐ржирзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Monitor regularly for early signs of disease.":
          "рж░рзЛржЧрзЗрж░ ржкрзНрж░рж╛ржержорж┐ржХ рж▓ржХрзНрж╖ржг ржирж┐рзЯржорж┐ржд ржиржЬрж░ рж░рж╛ржЦрзБржиред",
        "Ensure adequate spacing and soil drainage.":
          "ржкрж░рзНржпрж╛ржкрзНржд рж╕рзНржерж╛ржи ржПржмржВ ржорж╛ржЯрж┐рж░ ржЬрж▓ ржирж┐рж╖рзНржХрж╛рж╢ржи ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржиред",
        "Spray early morning every 7тАУ10 days starting at bud break.":
          "ржлрзБрж▓ ржлрзЛржЯрж╛рж░ рж╕ржорзЯ ржерзЗржХрзЗ ржкрзНрж░рждрж┐ рзн-рззрзж ржжрж┐ржирзЗ рж╕ржХрж╛рж▓ржмрзЗрж▓рж╛рзЯ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Continue regular monitoring.": "ржирж┐рзЯржорж┐ржд ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржЪрж╛рж▓рж┐рзЯрзЗ ржпрж╛ржиред",
        "Apply fungicide at tasseling and repeat if conditions favor disease.":
          "ржЯрзНржпрж╛рж╕рзЗрж▓рж┐ржВ рж╕ржорзЯрзЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржи ржПржмржВ рж░рзЛржЧрзЗрж░ ржЕржирзБржХрзВрж▓ ржкрж░рж┐рж╕рзНржерж┐рждрж┐рждрзЗ ржкрзБржирж░рж╛рзЯ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Spray when rust pustules first appear and repeat every 7тАУ14 days as needed.":
          "рж░рж╕рзНржЯ ржкрзБрж╖рзНржЯрзБрж▓ ржкрзНрж░ржержо ржжрзЗржЦрж╛ ржжрж┐рж▓рзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржи ржПржмржВ ржкрзНрж░рзЯрзЛржЬржи ржорждрзЛ ржкрзНрж░рждрж┐ рзн-рззрзк ржжрж┐ржирзЗ ржкрзБржирж░рж╛рзЯ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Scout fields regularly; apply fungicide at early signs of disease.":
          "ржорж╛ржа ржирж┐рзЯржорж┐ржд ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи; рж░рзЛржЧрзЗрж░ ржкрзНрж░рж╛ржержорж┐ржХ рж▓ржХрзНрж╖ржг ржжрзЗржЦрж▓рзЗ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржиред",
        "Spray every 7тАУ10 days until berries reach pea size.":
          "ржмрзЗрзЬрж┐ ржоржЯрж░ ржЖржХрж╛рж░ ржкрж░рзНржпржирзНржд ржкрзНрж░рждрж┐ рзн-рззрзж ржжрж┐ржирзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Avoid pruning during wet weather to reduce spread.":
          "ржнрзЗржЬрж╛ ржЖржмрж╣рж╛ржУрзЯрж╛рзЯ ржЫрж╛ржБржЯрж╛ржЗ ржПрзЬрж┐рзЯрзЗ ржЫрзЬрж╛ржирзЛ ржХржорж╛ржиред",
        "Begin spraying when new leaves emerge; repeat every 7тАУ14 days if needed.":
          "ржирждрзБржи ржкрж╛рждрж╛ ржмрзЗрж░ рж╣ржУрзЯрж╛рж░ рж╕ржорзЯ рж╕рзНржкрзНрж░рзЗ рж╢рзБрж░рзБ ржХрж░рзБржи; ржкрзНрж░рзЯрзЛржЬржи рж╣рж▓рзЗ ржкрзНрж░рждрж┐ рзн-рззрзк ржжрж┐ржирзЗ ржкрзБржирж░рж╛рзЯ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Apply systemic insecticide as per label instructions; maintain psyllid control programs.":
          "рж▓рзЗржмрзЗрж▓рзЗрж░ ржирж┐рж░рзНржжрзЗрж╢ржирж╛ ржЕржирзБржпрж╛рзЯрзА рж╕рж┐рж╕рзНржЯрзЗржорж┐ржХ ржХрзАржЯржирж╛рж╢ржХ ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржи; рж╕рж╛ржЗрж▓рж┐ржб ржирж┐рзЯржирзНрждрзНрж░ржг ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржмржЬрж╛рзЯ рж░рж╛ржЦрзБржиред",
        "Spray during early growing season; avoid overhead irrigation.":
          "ржмрж╛рзЬржирзНржд ржорж░рж╢рзБржорзЗрж░ рж╢рзБрж░рзБрждрзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржи; ржЙржкрж░рзЗ ржерзЗржХрзЗ рж╕рзЗржЪ ржПрзЬрж╛ржиред",
        "Spray every 7тАУ10 days; avoid working in wet fields to prevent spread.":
          "ржкрзНрж░рждрж┐ рзн-рззрзж ржжрж┐ржирзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржи; ржнрзЗржЬрж╛ ржорж╛ржарзЗ ржХрж╛ржЬ ржПрзЬрж╛ржи ржпрж╛рждрзЗ рж░рзЛржЧ ржЫрзЬрж╛ржирзЛ ржирж╛ рж╣рзЯред",
        "Spray every 7тАУ10 days until disease pressure subsides; remove and destroy crop debris.":
          "рж░рзЛржЧрзЗрж░ ржЪрж╛ржк ржХржорж╛ ржкрж░рзНржпржирзНржд ржкрзНрж░рждрж┐ рзн-рззрзж ржжрж┐ржирзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржи; ржлрж╕рж▓рзЗрж░ ржЕржмрж╢рж┐рж╖рзНржЯрж╛ржВрж╢ рж╕рж░рж┐рзЯрзЗ ржзрзНржмржВрж╕ ржХрж░рзБржиред",
        "Apply fungicide preventively in wet conditions; avoid overhead irrigation.":
          "ржнрзЗржЬрж╛ ржЖржмрж╣рж╛ржУрзЯрж╛рзЯ ржкрзНрж░рждрж┐рж░рзЛржзржорзВрж▓ржХ ржлрж╛ржЩрзНржЧрж┐рж╕рж╛ржЗржб ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржи; ржЙржкрж░рзЗ ржерзЗржХрзЗ рж╕рзЗржЪ ржПрзЬрж╛ржиред",
        "Maintain good air circulation and remove diseased canes.":
          "ржнрж╛рж▓ ржмрж╛рждрж╛рж╕ ржЪрж▓рж╛ржЪрж▓ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржПржмржВ рж╕ржВржХрзНрж░ржорж┐ржд ржХрзНржпрж╛ржирзНрж╕ рж╕рж░рж┐рзЯрзЗ ржлрзЗрж▓рзБржиред",
        "Practice crop rotation and field sanitation.":
          "ржлрж╕рж▓ ржкрж╛рж▓рзНржЯрзЗ рж▓рж╛ржЧрж╛ржи ржПржмржВ ржорж╛ржа ржкрж░рж┐ржЪрзНржЫржирзНржирждрж╛ ржмржЬрж╛рзЯ рж░рж╛ржЦрзБржиред",
        "Spray every 7тАУ10 days ensuring good airflow between plants.":
          "ржЧрж╛ржЫрзЗрж░ ржорж╛ржЭрзЗ ржнрж╛рж▓ ржмрж╛рждрж╛рж╕ ржЪрж▓рж╛ржЪрж▓ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржкрзНрж░рждрж┐ рзн-рззрзж ржжрж┐ржирзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Avoid wetting foliage during irrigation; spray every 7тАУ14 days if needed.":
          "рж╕рзЗржЪрзЗрж░ рж╕ржорзЯ ржкрж╛рждрж╛ ржнрж┐ржЬрж╛ржирзЛ ржерзЗржХрзЗ ржмрж┐рж░ржд ржерж╛ржХрзБржи; ржкрзНрж░рзЯрзЛржЬржи рж╣рж▓рзЗ ржкрзНрж░рждрж┐ рзн-рззрзк ржжрж┐ржирзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Spray every 7тАУ10 days during warm, wet conditions.":
          "ржЙрж╖рзНржг ржУ ржнрзЗржЬрж╛ ржЖржмрж╣рж╛ржУрзЯрж╛рзЯ ржкрзНрж░рждрж┐ рзн-рззрзж ржжрж┐ржирзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Start spraying at first sign of disease and continue through season.":
          "рж░рзЛржЧрзЗрж░ ржкрзНрж░ржержо рж▓ржХрзНрж╖ржг ржжрзЗржЦрж╛ ржжрж┐рж▓рзЗ рж╕рзНржкрзНрж░рзЗ рж╢рзБрж░рзБ ржХрж░рзБржи ржПржмржВ рж╕рж╛рж░рж╛ ржорж░рж╢рзБржо ржзрж░рзЗ ржЪрж╛рж▓рж┐рзЯрзЗ ржпрж╛ржиред",
        "Spray preventively especially during wet weather; avoid overhead irrigation.":
          "ржкрзНрж░рждрж┐рж░рзЛржзржорзВрж▓ржХ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржи ржмрж┐рж╢рзЗрж╖ ржХрж░рзЗ ржнрзЗржЬрж╛ ржЖржмрж╣рж╛ржУрзЯрж╛рзЯ; ржЙржкрж░рзЗ ржерзЗржХрзЗ рж╕рзЗржЪ ржПрзЬрж╛ржиред",
        "Spray every 7тАУ14 days; avoid wetting leaves while watering.":
          "ржкрзНрж░рждрж┐ рзн-рззрзк ржжрж┐ржирзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржи; рж╕рзЗржЪрзЗрж░ рж╕ржорзЯ ржкрж╛рждрж╛ ржнрзЗржЬрж╛ржирзЛ ржерзЗржХрзЗ ржмрж┐рж░ржд ржерж╛ржХрзБржиред",
        "Rotate crops and avoid overhead watering.":
          "ржлрж╕рж▓ ржкрж╛рж▓рзНржЯрзЗ рж▓рж╛ржЧрж╛ржи ржПржмржВ ржЙржкрж░рзЗ ржерзЗржХрзЗ ржкрж╛ржирж┐ ржжрзЗржУрзЯрж╛ ржПрзЬрж╛ржиред",
        "Maintain high humidity and avoid water stress; spray every 7 days if infestation persists.":
          "ржЙржЪрзНржЪ ржЖрж░рзНржжрзНрж░рждрж╛ ржмржЬрж╛рзЯ рж░рж╛ржЦрзБржи ржПржмржВ ржкрж╛ржирж┐ рж╕ржЩрзНржХржЯ ржПрзЬрж╛ржи; ржЖржХрзНрж░рж╛ржирзНржд рж╣рж▓рзЗ ржкрзНрж░рждрж┐ рзн ржжрж┐ржирзЗ рж╕рзНржкрзНрж░рзЗ ржХрж░рзБржиред",
        "Remove and destroy infected leaves.":
          "рж╕ржВржХрзНрж░ржорж┐ржд ржкрж╛рждрж╛ рж╕рж░рж┐рзЯрзЗ ржзрзНржмржВрж╕ ржХрж░рзБржиред",
        "Apply insecticide every 10тАУ14 days; remove infected plants immediately.":
          "ржкрзНрж░рждрж┐ рззрзж-рззрзк ржжрж┐ржирзЗ ржХрзАржЯржирж╛рж╢ржХ ржкрзНрж░рзЯрзЛржЧ ржХрж░рзБржи; рж╕ржВржХрзНрж░ржорж┐ржд ржЧрж╛ржЫ ржжрзНрж░рзБржд рж╕рж░рж┐рзЯрзЗ ржлрзЗрж▓рзБржиред",
        "Control aphids; avoid smoking in the field.":
          "ржПржлрж┐ржб ржирж┐рзЯржирзНрждрзНрж░ржг ржХрж░рзБржи; ржорж╛ржарзЗ ржзрзВржоржкрж╛ржи ржПрзЬрж╛ржиред",
        "Ensure adequate watering and nutrient supply.":
          "ржкрж░рзНржпрж╛ржкрзНржд ржкрж╛ржирж┐ ржУ ржкрзБрж╖рзНржЯрж┐ рж╕рж░ржмрж░рж╛рж╣ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржиред",
      };

      return {
        suggestedPesticide:
          dict[data.suggestedPesticide] || data.suggestedPesticide,
        treatment: dict[data.treatment] || data.treatment,
        plantCareAdvice: dict[data.plantCareAdvice] || data.plantCareAdvice,
      };
    }
    return data; // if English, just return as is
  };

  const displayedPrescription = translatePrescription(prescriptionData);

  const generatePDF = () => {
    console.log("printRef.current:", printRef.current);
    if (!displayedPrescription) return;

    // Clean up old blob URL if exists to avoid memory leaks
    if (pdfUrl) {
      URL.revokeObjectURL(pdfUrl);
      setPdfUrl(null);
    }

    if (language === "bn") {
      if (!printRef.current) {
        alert("Bangla content not ready for PDF.");
        console.error("printRef.current is null");
        return;
      }
      const printElement = printRef.current;

      // Temporarily force background and text color for canvas rendering
      const originalBackground = printElement.style.backgroundColor;
      const originalColor = printElement.style.color;

      printElement.style.backgroundColor = "#ffffff";
      printElement.style.color = "#000000";

      html2canvas(printElement, {
        scale: 2,
        useCORS: true,
        backgroundColor: "#ffffff",
        allowTaint: true,
        logging: true,
      })
        .then((canvas) => {
          const imgData = canvas.toDataURL("image/png");
          const pdf = new jsPDF({
            orientation: "portrait",
            unit: "pt",
            format: "a4",
          });

          const pdfWidth = pdf.internal.pageSize.getWidth();
          const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
          const margin = 20;

          pdf.addImage(
            imgData,
            "PNG",
            margin,
            margin,
            pdfWidth - 2 * margin,
            pdfHeight
          );
          const pdfBlob = pdf.output("blob");
          // Convert blob to base64 for Market page
          const reader = new FileReader();
          reader.onloadend = () => {
            const base64data = reader.result.split(",")[1];
            setPdfBase64ForMarket(base64data);
          };
          reader.readAsDataURL(pdfBlob);
          const url = URL.createObjectURL(pdfBlob);
          setPdfUrl(url); //  for preview
          setShowModal(true); //  open modal
          pdf.save("plant_disease_prescription_bn.pdf");
          printElement.style.backgroundColor = originalBackground;
          printElement.style.color = originalColor;
        })
        .catch((err) => {
          console.error("PDF Generation Error in Bangla mode:", err);
          alert("Failed to generate Bangla PDF. Please try again.");
        });
    } else {
      try {
        const doc = new jsPDF();
        doc.setFont("helvetica");
        doc.setFontSize(16);
        doc.text(translations[language].suggestedTreatment, 10, 20);
        doc.setFontSize(12);
        const lineHeight = 10;
        let y = 40;
        const maxWidth = 180; // you can adjust width as needed

        // Suggested Pesticide
        const pesticideText = `${translations[language].suggestedPesticide}: ${
          displayedPrescription.suggestedPesticide || "-"
        }`;
        const pesticideLines = doc.splitTextToSize(pesticideText, maxWidth);
        pesticideLines.forEach((line) => {
          doc.text(line, 10, y);
          y += lineHeight;
        });
        y += lineHeight; // extra spacing after block

        // Treatment
        const treatmentText = `${translations[language].treatment}: ${
          displayedPrescription.treatment || "-"
        }`;
        const treatmentLines = doc.splitTextToSize(treatmentText, maxWidth);
        treatmentLines.forEach((line) => {
          doc.text(line, 10, y);
          y += lineHeight;
        });
        y += lineHeight;

        // Plant Care Advice
        const adviceText = `${translations[language].plantCareAdvice}: ${
          displayedPrescription.plantCareAdvice || "-"
        }`;
        const adviceLines = doc.splitTextToSize(adviceText, maxWidth);
        adviceLines.forEach((line) => {
          doc.text(line, 10, y);
          y += lineHeight;
        });
        y += lineHeight;

        // Create blob & URL for preview
        const pdfBlob = doc.output("blob");
        const url = URL.createObjectURL(pdfBlob);
        setPdfUrl(url);

        // generate base64 string to pass to Market
        const pdfBase64 = doc.output("datauristring").split(",")[1];

        setShowModal(true);

        // save if needed
        doc.save("plant_disease_prescription.pdf");

        // store in state so you can use it in the button click
        setPdfBase64ForMarket(pdfBase64);
      } catch (error) {
        console.error("English PDF Generation Error:", error);
        alert("Failed to generate English PDF.");
      }
    }
  };

  function convertToBanglaDigits(number) {
    const banglaDigits = ["рзж", "рзз", "рзи", "рзй", "рзк", "рзл", "рзм", "рзн", "рзо", "рзп"];
    return number
      .toString()
      .split("")
      .map((d) => (d === "." ? "." : banglaDigits[d]))
      .join("");
  }
  return (
    <div className="relative min-h-screen w-full flex items-center justify-center px-4 overflow-hidden">
      {/* Fullscreen video background */}
      <div className="fixed inset-0 z-0 overflow-hidden">
        <video
          autoPlay
          loop
          muted
          playsInline
          className="w-full h-full object-cover"
          style={{ filter: "blur(4px) brightness(0.75)" }}
        >
          <source
            src="https://cdn.pixabay.com/video/2016/11/13/6338-191338827_large.mp4"
            type="video/mp4"
          />
          Your browser does not support the video tag.
        </video>
      </div>

      {/* Main content container */}
      <div className="relative w-full max-w-6xl h-[1500px] mt-4 mx-auto rounded-3xl p-10 shadow-2xl backdrop-blur-md bg-white/80 z-10 overflow-y-auto overflow-x-hidden">
        {/* Language Selector */}
        <div className="flex justify-end mb-6">
          <select
            value={language}
            onChange={(e) => setLanguage(e.target.value)}
            className="border border-gray-300 rounded-md px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-green-500"
          >
            <option value="en">English</option>
            <option value="bn">ржмрж╛ржВрж▓рж╛</option>
          </select>
        </div>

        <div className="flex flex-col items-center justify-center mb-6 text-center">
          {/* Upload Label */}
          <label className="flex text-3xl font-extrabold text-green-900  tracking-wide items-center gap-2 select-none drop-shadow-md bg-gradient-to-r from-green-900 to-green-200 bg-clip-text">
            {translations[language].uploadLabel}
            <FaLeaf className="text-green-900 text-2xl animate-pulse" />
          </label>

          {/* File Input */}
          <input
            type="file"
            accept="image/*"
            onChange={handleImageChange}
            className="w-full max-w-md  mt-4 text-gray-700 file:mr-4 file:py-2 file:px-6 file:rounded-full file:border-0 file:bg-green-800 file:text-green-200 hover:file:bg-green-700 transition mb-6"
          />
        </div>

        {/* Preview & Detection */}
        {preview && (
          <div className="flex flex-col items-center space-y-6  w-full max-w-full">
            <img
              src={preview}
              alt="Preview"
              className="w-full max-w-sm rounded-xl shadow-lg border border-gray-200 object-contain"
            />

            <button
              onClick={handleDetect}
              className="w-full bg-green-600 text-white font-semibold py-3 rounded-xl hover:bg-green-700 shadow-md transition disabled:bg-green-400"
              disabled={loading}
            >
              {loading
                ? translations[language].detectingButton
                : translations[language].detectButton}
            </button>

            {/* Result Display */}
            {result && !result.error && (
              <div className="w-full bg-gray-50 rounded-xl p-6 shadow-inner border border-gray-200 text-center min-h-[1200px]">
                <p className="text-lg font-semibold text-gray-900">
                  {translations[language].prediction}:
                </p>
                <p className="text-2xl text-green-700 font-bold mb-2">
                  {language === "bn"
                    ? translations.bn.diseaseDict[result.prediction] ||
                      result.prediction
                    : result.prediction}
                </p>

                {result?.confidence !== undefined && (
                  <p className="text-gray-700 mb-4">
                    {translations[language].confidence}:{" "}
                    <span className="font-medium text-black">
                      {language === "bn"
                        ? convertToBanglaDigits(result.confidence.toFixed(2))
                        : result.confidence.toFixed(2)}
                      %
                    </span>
                  </p>
                )}

                {/* Prescription Button */}
                {!showPrescription &&
                  prescriptionData &&
                  !prescriptionData.error && (
                    <button
                      onClick={() => setShowPrescription(true)}
                      className="mt-3 bg-green-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-green-700 transition"
                    >
                      {translations[language].generatePrescription}
                    </button>
                  )}

                {/* Prescription Display */}
                {showPrescription && (
                  <>
                    <div
                      ref={printRef}
                      style={{
                        backgroundColor: "white",
                        padding: "1.5rem",
                        borderRadius: "0.75rem",
                        boxShadow: "0 4px 20px rgba(0,0,0,0.1)",
                        fontFamily:
                          language === "bn"
                            ? "'Noto Sans Bengali', sans-serif"
                            : "Arial, sans-serif",
                        color: "#111",
                        marginTop: ".5rem",
                        minHeight: "400px",
                        textAlign: "left",
                      }}
                    >
                      <h3
                        style={{
                          fontWeight: "700",
                          color: "#15803d",
                          fontSize: "2rem",
                          margin: "2rem 0 2rem",
                          textAlign: "center",
                        }}
                      >
                        ЁЯзк {translations[language].suggestedTreatment}
                      </h3>

                      <p
                        style={{ fontSize: "1.25rem", marginBottom: "0.5rem" }}
                      >
                        <strong>
                          {translations[language].suggestedPesticide}:
                        </strong>{" "}
                        {displayedPrescription.suggestedPesticide}
                      </p>

                      <p
                        style={{ fontSize: "1.25rem", marginBottom: "0.5rem" }}
                      >
                        <strong>{translations[language].treatment}:</strong>{" "}
                        {displayedPrescription.treatment}
                      </p>

                      <p style={{ fontSize: "1.25rem" }}>
                        <strong>
                          {translations[language].plantCareAdvice}:
                        </strong>{" "}
                        {displayedPrescription.plantCareAdvice}
                      </p>
                    </div>

                    <div className="mt-6 text-center">
                      <button
                        onClick={generatePDF}
                        style={{
                          backgroundColor: "#15803d",
                          color: "white",
                          padding: "0.75rem 2rem",
                          borderRadius: "0.75rem",
                          fontWeight: "600",
                          marginTop: "1rem",
                          cursor: "pointer",
                        }}
                      >
                        {language === "bn"
                          ? "ржкрж┐ржбрж┐ржПржл ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи"
                          : "Generate PDF"}
                      </button>
                    </div>
                  </>
                )}

                {/* Error Message */}
                {prescriptionData?.error && (
                  <p className="mt-6 text-red-600 font-semibold">
                    {prescriptionData.error}
                  </p>
                )}

                {/* PDF Modal */}
                {showModal && pdfUrl && (
                  <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-3xl">
                    <div className="bg-white w-[50vw] h-[80vh] rounded-3xl shadow-2xl p-8 relative flex flex-col border border-gray-200">
                      <div className="flex justify-between items-center mb-4">
                        <h2 className="text-2xl font-bold text-gray-800">
                          ЁЯУД PDF Preview
                        </h2>
                        <button
                          onClick={() => setShowModal(false)}
                          className="text-red-500 hover:text-red-700 text-3xl leading-none"
                        >
                          &times;
                        </button>
                      </div>

                      <iframe
                        src={pdfUrl}
                        title="PDF Preview"
                        className="flex-1 w-full rounded-lg border"
                      />

                      <div className="mt-6 flex justify-end">
                        <button
                          onClick={() => {
                            setShowModal(false);
                            navigate("/market", {
                              state: {
                                pdfBase64: pdfBase64ForMarket,
                                language: language,
                              },
                            });
                          }}
                          className="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-6 py-3 rounded-lg shadow-md transition"
                        >
                          ЁЯЫН Go to Market
                        </button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
}

export default Plantdiseaseditect;
